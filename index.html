<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>QuickDash - Groceries in Minutes</title>

    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <link rel="stylesheet" href="/assets/css/base.css">
    <link rel="stylesheet" href="/assets/css/components.css">
    <link rel="stylesheet" href="/assets/css/assistant.css">
    <link rel="stylesheet" href="/assets/css/home.css">

    <script>
        (function() {
            function safeJsonParse(key) {
                try { return JSON.parse(localStorage.getItem(key)); } catch (e) { return null; }
            }
            window.APP_CONFIG = {
                // IMPORTANT: Point this to your running Django Server
                API_BASE: "http://127.0.0.1:8000/api/v1", 
                USER: safeJsonParse('user'),
                IS_LOGGED_IN: !!localStorage.getItem('access_token'),
                URLS: {
                    HOME: '/index.html',
                    LOGIN: '/auth.html',
                    CART: '/cart.html',
                    SEARCH: '/search_results.html'
                }
            };
            // Backward compatibility
            window.API_BASE = window.APP_CONFIG.API_BASE;
        })();
    </script>
</head>

<body>

    <div id="navbar-placeholder"></div>

    <main>
        <div class="hero-wrapper">
            <div id="hero-slider" class="scroll-banner">
                <div class="promo-card skeleton"></div>
            </div>
        </div>

        <div class="features-bar" style="display: flex; justify-content: space-between; padding: 15px 20px; background: #f9fcf9; border-bottom: 1px solid #f0f0f0;">
            <div class="feature-item" style="font-weight:600; font-size:0.8rem; color:#2d3436;">
                <i class="fas fa-bolt text-success"></i> 10 min Delivery
            </div>
            <div class="feature-item" style="font-weight:600; font-size:0.8rem; color:#2d3436;">
                <i class="fas fa-award text-success"></i> Best Quality
            </div>
            <div class="feature-item" style="font-weight:600; font-size:0.8rem; color:#2d3436;">
                <i class="fas fa-tags text-success"></i> Low Prices
            </div>
        </div>

        <section>
            <div class="section-header" style="display:flex; justify-content:space-between; padding:20px 20px 10px;">
                <h3 style="font-size:1.2rem; font-weight:700;">Explore Categories</h3>
                <a href="/category.html" style="color:var(--primary); font-weight:600; font-size:0.9rem;">View All</a>
            </div>
            <div id="home-category-grid">
                <div class="skeleton" style="height:80px; width:100%; border-radius:12px;"></div>
            </div>
        </section>

        <div id="mid-banner-container" class="mid-banner" style="display: none;"></div>

        <section id="flash-sale-section" class="flash-sale-container my-3" style="display: none;">
            <div class="flash-header" style="display:flex; justify-content:space-between; margin-bottom:15px;">
                <div style="display:flex; align-items:center; gap:8px;">
                    <i class="fas fa-bolt" style="color:#e67e22;"></i>
                    <h3 style="font-size:1.1rem; font-weight:800; color:#e67e22; margin:0;">Deal of the Day</h3>
                </div>
                <div class="flash-timer" id="flash-timer-display" style="font-size:0.85rem; color:#d35400; font-weight:600;">--</div>
            </div>
            <div id="flash-sale-grid" class="flash-grid"></div>
        </section>

        <section class="brands-section" style="background:#fff; padding-bottom:20px; border-bottom:1px solid #f0f0f0;">
            <div class="section-header" style="padding:20px;">
                <h3 style="font-size:1.2rem; font-weight:700;">Top Brands</h3>
            </div>
            <div id="brand-scroller" class="brand-scroller">
                </div>
        </section>

        <div id="dynamic-sections-container" style="min-height: 200px;">
            <div id="shelves-loader" class="text-center py-4">
                <div class="loader">Loading shelves...</div>
            </div>
        </div>
    </main>

    <div id="footer-placeholder"></div>

    <div id="ast-btn" class="assistant-btn">
        <img src="/assets/img/robot_icon.png" alt="Bot" style="width: 40px; height: 40px; object-fit: contain;">
    </div>
    <div id="ast-box" class="assistant-box">
        <div class="ast-header">
            <h4>QuickDash Assistant</h4>
            <i class="fas fa-times" id="ast-close" style="cursor:pointer;"></i>
        </div>
        <div class="ast-body" id="ast-msgs"></div>
        <div class="ast-footer">
            <input type="text" id="ast-input" placeholder="Type '5kg Onion'...">
            <button id="ast-send"><i class="fas fa-paper-plane"></i></button>
        </div>
    </div>

    <div id="location-modal" class="location-modal hidden">
        <div class="modal-content">
            <div class="modal-header" style="padding:15px; display:flex; justify-content:space-between;">
                <h3>Select Location</h3>
                <button id="close-loc-modal" style="border:none; background:none; font-size:1.2rem;">&times;</button>
            </div>
            <div class="map-container" style="position: relative; height: 350px;">
                <div id="picker-map" style="width: 100%; height: 100%;"></div>
                <div class="center-pin" style="position:absolute; top:50%; left:50%; transform:translate(-50%,-100%); z-index:1000; pointer-events:none;">
                    <i class="fas fa-map-marker-alt" style="color:red; font-size:3rem;"></i>
                </div>
                <button id="btn-trigger-gps" class="btn-gps-float"><i class="fas fa-crosshairs"></i></button>
            </div>
            <div class="location-details" style="padding:20px;">
                <h4 id="loc-address-title">Select location</h4>
                <p id="loc-address-text">...</p>
                <div id="service-error" class="error-msg hidden">Not available here.</div>
                <button id="btn-confirm-location" class="btn-primary w-100" style="padding:10px; border-radius:8px; border:none; background:#32CD32; color:white;" disabled>Confirm</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/assets/js/utils/api.js"></script>
    <script src="/assets/js/utils/validators.js"></script>
    <script src="/assets/js/utils/formatters.js"></script>
    <script src="/assets/js/utils/assistant.js"></script>
    <script src="/assets/js/utils/search.js"></script>
    <script src="/assets/js/utils/location_picker.js"></script>
    <script src="/assets/js/utils/location_manager.js"></script>
    <script src="/assets/js/utils/base.js"></script>
    
    <script src="/assets/js/layout.js"></script>
    <script src="/assets/js/utils/home.js"></script>

</body>
</html>